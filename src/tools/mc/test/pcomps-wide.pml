(*** Utility Functions ***)

fun catw (sep, ss) =
  (case ss
     of nil => ""
      | s::nil => s
      | s::ss  => s ^ sep ^ (catw (sep, ss))
    (* end case *));

fun parString a =
  let val len = plen a
      fun build (curr, acc) =
        if curr=len
        then rev acc
        else build (curr+1, (Int.toString (a!curr)) :: acc)
  in
      "[|" ^ (catw (",", build (0, nil))) ^ "|]"
  end;

fun printPar(a) =
  (print "result   ";
   print (parString(a));
   print "\n");

(* Tests (machine-generated) *)

val _ = print "testing parallel comprehension with 2 pbinds and 10 elements per binding\n";
val parcomp =
 [| (if (a>b) then a else b) |
      a in [|64,3,73,20,60,71,38,39,82,86|],
      b in [|87,49,98,17,50,32,78,22,54,83|] |]
;
val _ = printPar(parcomp);
val _ = print "expected [|87,49,98,20,60,71,78,39,82,86|]\n\n";


val _ = print "testing parallel comprehension with 2 pbinds and 20 elements per binding\n";
val parcomp =
 [| (if (a>b) then a else b) |
      a in [|37,46,63,19,98,57,97,17,88,19,78,71,46,90,45,44,70,47,99,17|],
      b in [|79,40,71,19,96,6,91,83,88,7,73,45,98,7,28,34,82,39,3,95|] |]
;
val _ = printPar(parcomp);
val _ = print "expected [|79,46,71,19,98,57,97,83,88,19,78,71,98,90,45,44,82,47,99,95|]\n\n";


val _ = print "testing parallel comprehension with 2 pbinds and 30 elements per binding\n";
val parcomp =
 [| (if (a>b) then a else b) |
      a in [|42,43,84,4,7,52,58,87,94,35,49,64,93,95,84,32,59,55,41,62,54,78,75,94,25,19,55,0,43,71|],
      b in [|54,70,85,53,41,15,95,4,84,8,88,20,92,34,82,59,11,10,43,5,31,36,24,71,50,61,53,93,83,48|] |]
;
val _ = printPar(parcomp);
val _ = print "expected [|54,70,85,53,41,52,95,87,94,35,88,64,93,95,84,59,59,55,43,62,54,78,75,94,50,61,55,93,83,71|]\n\n";


val _ = print "testing parallel comprehension with 2 pbinds and 40 elements per binding\n";
val parcomp =
 [| (if (a>b) then a else b) |
      a in [|28,96,65,76,67,10,55,41,89,91,47,67,35,32,21,48,2,31,92,23,30,81,39,9,62,58,55,74,87,77,23,55,58,65,78,21,27,93,71,51|],
      b in [|80,47,14,21,86,10,0,24,47,0,93,32,80,63,33,36,55,19,10,3,48,27,41,46,36,91,68,87,59,39,85,10,47,68,11,59,50,77,64,16|] |]
;
val _ = printPar(parcomp);
val _ = print "expected [|80,96,65,76,86,10,55,41,89,91,93,67,80,63,33,48,55,31,92,23,48,81,41,46,62,91,68,87,87,77,85,55,58,68,78,59,50,93,71,51|]\n\n";


val _ = print "testing parallel comprehension with 2 pbinds and 50 elements per binding\n";
val parcomp =
 [| (if (a>b) then a else b) |
      a in [|33,92,18,54,38,91,16,11,25,51,18,94,78,38,88,36,64,71,65,78,3,81,43,22,13,45,19,10,42,13,92,30,71,85,65,70,41,49,37,48,16,28,95,34,13,79,36,13,42,24|],
      b in [|47,21,89,70,97,31,58,39,0,91,54,70,83,32,59,69,16,42,84,20,6,67,34,83,54,97,5,35,59,21,98,33,50,89,14,18,78,67,17,32,49,11,25,56,80,36,6,60,62,65|] |]
;
val _ = printPar(parcomp);
val _ = print "expected [|47,92,89,70,97,91,58,39,25,91,54,94,83,38,88,69,64,71,84,78,6,81,43,83,54,97,19,35,59,21,98,33,71,89,65,70,78,67,37,48,49,28,95,56,80,79,36,60,62,65|]\n\n";


val _ = print "testing parallel comprehension with 2 pbinds and 60 elements per binding\n";
val parcomp =
 [| (if (a>b) then a else b) |
      a in [|82,41,23,15,89,91,24,87,67,6,3,5,83,16,62,82,90,75,87,92,97,76,81,75,90,31,8,23,85,57,8,99,45,55,81,39,94,64,28,10,5,47,20,98,92,23,37,92,28,95,22,75,17,26,67,40,80,15,75,6|],
      b in [|59,41,75,37,8,91,95,56,96,53,34,3,74,76,8,25,32,46,80,42,82,83,76,48,76,20,12,37,13,56,70,90,62,12,17,54,25,27,90,11,87,45,22,78,82,86,90,73,4,67,32,53,65,49,82,54,45,84,36,88|] |]
;
val _ = printPar(parcomp);
val _ = print "expected [|82,41,75,37,89,91,95,87,96,53,34,5,83,76,62,82,90,75,87,92,97,83,81,75,90,31,12,37,85,57,70,99,62,55,81,54,94,64,90,11,87,47,22,98,92,86,90,92,28,95,32,75,65,49,82,54,80,84,75,88|]\n\n";


val _ = print "testing parallel comprehension with 2 pbinds and 70 elements per binding\n";
val parcomp =
 [| (if (a>b) then a else b) |
      a in [|21,84,59,25,54,47,80,42,71,90,51,62,90,77,53,34,17,36,4,2,84,53,22,49,96,60,63,60,23,30,76,82,16,35,67,95,19,73,24,29,13,10,23,87,31,96,46,12,34,71,99,28,70,87,55,85,93,86,67,72,91,55,95,73,70,69,73,60,88,67|],
      b in [|20,80,73,9,1,58,33,26,98,86,93,33,99,38,56,29,97,67,22,41,59,56,46,79,18,62,95,81,86,8,95,73,5,19,54,50,52,43,18,47,52,18,45,36,9,43,31,7,73,4,33,92,96,41,51,87,17,80,33,53,61,60,69,83,81,63,71,67,10,33|] |]
;
val _ = printPar(parcomp);
val _ = print "expected [|21,84,73,25,54,58,80,42,98,90,93,62,99,77,56,34,97,67,22,41,84,56,46,79,96,62,95,81,86,30,95,82,16,35,67,95,52,73,24,47,52,18,45,87,31,96,46,12,73,71,99,92,96,87,55,87,93,86,67,72,91,60,95,83,81,69,73,67,88,67|]\n\n";


val _ = print "testing parallel comprehension with 2 pbinds and 80 elements per binding\n";
val parcomp =
 [| (if (a>b) then a else b) |
      a in [|61,10,94,64,99,3,60,24,86,10,97,67,62,62,53,47,72,96,21,0,66,13,63,22,99,90,62,96,65,3,44,67,87,85,54,50,36,18,79,27,31,27,30,77,27,19,68,19,99,53,77,31,78,95,53,86,5,43,37,37,78,30,31,84,48,33,55,21,16,9,94,34,77,42,10,41,34,90,16,30|],
      b in [|91,47,79,72,36,58,81,25,40,38,88,3,30,50,44,69,35,6,62,91,76,95,63,40,26,85,94,37,31,35,29,16,41,74,37,32,89,97,15,20,62,5,18,70,55,26,5,59,80,77,87,67,98,48,63,98,79,82,12,73,66,65,53,64,24,6,11,26,24,86,72,55,30,38,11,97,58,56,4,65|] |]
;
val _ = printPar(parcomp);
val _ = print "expected [|91,47,94,72,99,58,81,25,86,38,97,67,62,62,53,69,72,96,62,91,76,95,63,40,99,90,94,96,65,35,44,67,87,85,54,50,89,97,79,27,62,27,30,77,55,26,68,59,99,77,87,67,98,95,63,98,79,82,37,73,78,65,53,84,48,33,55,26,24,86,94,55,77,42,11,97,58,90,16,65|]\n\n";


val _ = print "testing parallel comprehension with 2 pbinds and 90 elements per binding\n";
val parcomp =
 [| (if (a>b) then a else b) |
      a in [|92,21,39,10,99,22,94,96,71,52,8,86,86,54,15,22,37,6,2,35,41,70,20,16,53,69,6,17,82,8,44,55,25,38,82,60,42,35,50,52,80,28,91,94,8,43,79,35,8,52,70,39,72,19,40,91,99,93,12,20,67,61,43,17,63,56,76,87,77,48,32,9,23,61,48,59,22,21,88,59,36,12,13,10,90,78,17,35,25,98|],
      b in [|13,76,1,98,8,38,67,20,33,51,39,98,18,57,10,5,30,55,5,8,36,88,47,90,92,92,50,61,57,72,8,15,24,35,85,15,79,42,56,49,11,31,68,96,50,27,20,48,57,41,88,63,41,68,41,23,16,1,85,17,33,35,9,24,7,41,14,69,23,75,77,0,16,80,47,5,9,17,37,40,30,30,60,57,50,75,37,30,3,39|] |]
;
val _ = printPar(parcomp);
val _ = print "expected [|92,76,39,98,99,38,94,96,71,52,39,98,86,57,15,22,37,55,5,35,41,88,47,90,92,92,50,61,82,72,44,55,25,38,85,60,79,42,56,52,80,31,91,96,50,43,79,48,57,52,88,63,72,68,41,91,99,93,85,20,67,61,43,24,63,56,76,87,77,75,77,9,23,80,48,59,22,21,88,59,36,30,60,57,90,78,37,35,25,98|]\n\n";

()
