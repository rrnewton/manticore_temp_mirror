(* locked-queue.def
 *
 * COPYRIGHT (c) 2007 The Manticore Project (http://manticore.cs.uchicago.edu)
 * All rights reserved.
 *
 * Types and HLops for locked-queues.
 *)

#ifndef _LOCKED_QUEUE_DEF_
#define _LOCKED_QUEUE_DEF_

#include "types.def"

typedef queue_elt = ![any, any];
(* lock, head, tail, blocked fiber head, blocked fiber tail *)
typedef locked_queue = ![bool, queue_elt, queue_elt, queue_elt, queue_elt];

#define LOCKED_QUEUE_LOCK           0
#define LOCKED_QUEUE_HD             1
#define LOCKED_QUEUE_TL             2
#define LOCKED_QUEUE_BLOCKED_HD     3
#define LOCKED_QUEUE_BLOCKED_TL     4

#define LOCKED_QUEUE_EMPTY	enum(0)

#define QUEUE_ELT_HD    0
#define QUEUE_ELT_TL    1

define @locked-queue-new ( / exh : exh) : locked_queue;
define @locked-queue-dequeue (q : locked_queue / exh : exh) : option;
define @locked-queue-enqueue (q : locked_queue, elt : any / exh : exh) : ();

#endif /* !_LOCKED_QUEUE_DEF_ */
