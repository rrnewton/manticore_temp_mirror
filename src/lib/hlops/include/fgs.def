(* fgs.def
 *
 * COPYRIGHT (c) 2007 The Manticore Project (http://manticore.cs.uchicago.edu)
 * All rights reserved.
 *
 * Types and HLops for fiber-group storage.
 *)

#ifndef _FGS_DEF_
#define _FGS_DEF_

#include "runtime-offsets.def"
#include "types.def"

(* [lock, killed, pinned, parent fgs (optional), auxilliary storage]
 *)
typedef fgs = ![bool, bool, bool, option, assoc_list];
typedef tid = fgs;

#define FGS_ALIST_OFFSET     4
#define FGS_LOCK_OFFSET      0
#define FGS_PARENT_OFFSET    3

define @new-fgs (pinned : bool, parent : option / exh : exh) : fgs;
define @get-fgs (vp : vproc / exh : exh) : fgs;
define inline @set-fgs (vp : vproc, fgs : fgs / exh : exh) : unit;

(* unique fiber id *)
typedef fid = int;
define @get-fid (vp : vproc / exh : exh) : fid;

define @assoc-list-lookup (atag : assoc_tag, init : fun(unit / exh -> any), fgs : fgs / exh : exh) : any;
define @assoc-list-query (atag : assoc_tag, fgs : fgs / exh : exh) : option;

define inline @get-uid (uidTag : assoc_tag, vp : vproc / exh : exh) : int;

#endif /*! _FGS_DEF_ */
