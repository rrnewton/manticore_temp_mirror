(* locked-queue.def
 *
 * COPYRIGHT (c) 2007 The Manticore Project (http://manticore.cs.uchicago.edu)
 * All rights reserved.
 *
 * Offsets and constants for locked queues.
 *)

#ifndef _LOCKED_QUEUE_DEF_
#define _LOCKED_QUEUE_DEF_

#define EMPTY	  enum(0)

#define LOCK_OFF           0
#define HD_OFF             1
#define TL_OFF             2
#define BLOCKED_HD_OFF     3
#define BLOCKED_TL_OFF     4

(* parameters for the spin-lock module *)
#define SPIN_LOCK_TY       InPlaceQueue.queue
#define LOCK_OFFSET        LOCK_OFF

(* create an in-place queue *)
#define NEW_IPQ(elt)      alloc (elt, EMPTY)

(* the vproc field contains the vproc on which the thread blocked *)
#define BLOCKED_THREAD_CONT_OFF     0
#define BLOCKED_THREAD_FGS_OFF      1
#define BLOCKED_THREAD_VPROC_OFF    2

#define BLOCKED_THREAD_NEW(blockedK, fgs)    alloc(blockedK, fgs, host_vproc)

#define NEW_ELT(elt) NEW_IPQ(elt)

#endif /*! _LOCKED_QUEUE_DEF_ */
